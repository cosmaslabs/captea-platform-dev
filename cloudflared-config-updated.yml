# Cosmaslabs OpenProject Cloudflare Tunnel Configuration
# Date: 2025-09-17
# Enhanced FHS Compliance: v4.0.0
# Tunnel ID: 40e26158-b34e-41ee-9839-9ddf9ebb33ff
# Tunnel Name: cosmaslabs-openproject-tunnel
# UPDATED: 2025-11-20 - Added Captea Platform web app

tunnel: 40e26158-b34e-41ee-9839-9ddf9ebb33ff
credentials-file: /home/cosmaslabs/.cloudflared/40e26158-b34e-41ee-9839-9ddf9ebb33ff.json

# Ingress rules for routing traffic
ingress:
  # Captea Platform web app (ADDED November 20, 2025)
  - hostname: captea.cosmaslabs.com
    service: http://localhost:8082
    originRequest:
      httpHostHeader: captea.cosmaslabs.com
      connectTimeout: 30s
      tlsTimeout: 10s
      tcpKeepAlive: 30s
      noTLSVerify: true # localhost doesn't have TLS

  # OpenProject service routing through Apache
  - hostname: openproject.cosmaslabs.com
    service: http://localhost:80
    originRequest:
      httpHostHeader: openproject.cosmaslabs.com
      connectTimeout: 30s
      tlsTimeout: 10s
      tcpKeepAlive: 30s
      keepAliveConnections: 100
      keepAliveTimeout: 90s

  # Catch-all rule (required as the last rule)
  - service: http_status:404

# Logging configuration
loglevel: info
logfile: /var/log/cloudflared/cosmaslabs-openproject-tunnel.log

# Connection settings
# Force HTTP/2 over 443 (avoid UDP/QUIC 7844 issues) and prefer IPv4 to reduce DNS/IPv6 flakiness
protocol: http2
no-quic: true
retries: 5
grace-period: 30s
edge-ip-version: "4"

# Metrics and monitoring (avoid port conflicts with other services)
metrics: 127.0.0.1:9105
